from fastapi import UploadFile, HTTPException
from PIL import Image
from google import genai
from google.genai import types
import os
from dotenv import load_dotenv
import pdfplumber
from io import BytesIO
from typing import List, Dict, Union
from docx import Document
from judgement import JudgementStorage
from labour_law import LaborLawStorage
from routers.letter_format_api import LetterFormatStorage
from google.cloud import vision
import io
from google.cloud.vision import ImageAnnotatorClient
import pandas as pd

# Load environment variables from .env file
load_dotenv()

class DocumentProcessor:
    def __init__(self):
        # Initialize Vision client with API key
        vision_api_key = os.getenv("GOOGLE_CLOUD_VISION_API_KEY")
        if not vision_api_key:
            raise Exception("Google Cloud Vision API key not found. Please set GOOGLE_CLOUD_VISION_in your .env filevariable.")
        
        self.vision_client = ImageAnnotatorClient(client_options={"api_key": vision_api_key})
        self.image_context = {"language_hints": ["he"]} 
        self.letter_format = LetterFormatStorage()
        self.law_storage = LaborLawStorage()
        self.judgement_storage = JudgementStorage()

    def process_document(self, files: Union[UploadFile, List[UploadFile]], doc_types: Union[str, List[str]], compress: bool = False) -> Dict[str, str]:
        if not files:
            raise HTTPException(
                status_code=400,
                detail="At least one document must be provided"
            )
        
        # Handle single file case
        if isinstance(files, UploadFile):
            files = [files]
            doc_types = [doc_types]
        elif not isinstance(doc_types, list):
            doc_types = [doc_types] * len(files)
        
        # Initialize text storage
        payslip_text = None
        contract_text = None
        attendance_text = None
        
        # Initialize payslip counter
        payslip_counter = 0
        # Process each file based on its type
        for file, doc_type in zip(files, doc_types):
            extracted_text = self._extract_text2(file.file.read(), file.filename, compress=compress)
            if doc_type.lower() == "payslip":
                payslip_counter += 1
                payslip_text = f"Payslip {payslip_counter}:\n{extracted_text}" if payslip_text is None else f"{payslip_text}\n\nPayslip {payslip_counter}:\n{extracted_text}"
            elif doc_type.lower() == "contract":
                contract_text = extracted_text
            elif doc_type.lower() == "attendance":
                attendance_text = extracted_text
        # Return the extracted texts
        return {
            "payslip_text": payslip_text,
            "contract_text": contract_text,
            "attendance_text": attendance_text
        }
    
    def create_report(self, payslip_text: str = None, contract_text: str = None, attendance_text: str = None, type: str = "report", context: str = None) -> Dict:
        # Prepare documents for analysis
        # payslip_text = "Payslip 1:\nIncome-TAX-Deduction\nHealth insurancet\nPension contribution\nNet salary\n211030000\n5:00\n905328\n10:07 000\n00\n42\n00\n00\n00\n01\n12\n00\n03\n×ž×¡ ×”×›× ×¡×”\n×§.×”×©×ª×œ×•××¨×’ ×‘×™× \"×œ\n×‘×˜×•×— ×œ××•×ž×™.\n×‘×©×•×— ×‘×¨×™××•×ª\n×“×ž×™ × ×™×”×•×œ ×¤× ×¡×™×” ×ª\n×§×•×¤×ª ×’×ž×œ ×¨×©×£\n185467\n50589\n59571\n55491\n24090\n4002\n×¡×”\"×› × ×™×›×•×™×™× 379210\n×¡×›×•×\n×‘× × ×§\n×”×ª×—×œ×” ×©×œ\n#730\n1.00000\n0.10000\nHop T\n3300\nING OLD\n× ×ª×•× ×™ ×¢×–×¨\n...\n...\nyaw ng\n2 TRDN\n6\n003\n40 3 6\n31 40 3\n176\na uud\n210\n×ª×©×œ×•×ž×™×\nphen DOR\n1095000\n109500\n61600\n3038\n15400\n(DVT)\n×ž×©×•×œ×‘ ××•×¤×§ ×—×“×©\n×’×ž×•×œ ×—×™× ×•×š ×›×™×ª×”\n×§×¦×•×‘×ª × ×¡×™×¢×”\n×”×—×–×¨ ×˜×œ×¤×•×Ÿ\n×ž×§ × ×¡×™×¢×•×ª ×‘×ª×¤×§\n×¡×”\"×› ×ª×©×œ×•×ž×™× ×© 1284538\n1000\n15\n1522700\n2\n500\n10:0\nUQLU\n60 01 30 09 2008\n70\n89\n01 30 09 2008\n×‘×¨×•×˜×• ×ž×¦×˜×‘×¨ ×œ×ž×.\n10859963\n9\n510300\n×ª××•× ×ž×¡ ×”×›× ×¡×”\n×‘×™× ×œ\n×§×¨×Ÿ ×”×©×ª\n420\nGress Income - TAX - Deduction Health insurancet Pension contribution Net salary 211030000 5:00 905328 10:07 000 00 42 00 00 00 01 12 00 03 ×ž×¡ ×”×›× ×¡×” ×§.×”×©×ª×œ×•××¨×’ ×‘×™× \"×œ ×‘×˜×•×— ×œ××•×ž×™ . ×‘×©×•×— ×‘×¨×™××•×ª ×“×ž×™ × ×™×”×•×œ ×¤× ×¡×™×” ×ª ×§×•×¤×ª ×’×ž×œ ×¨×©×£ 185467 50589 59571 55491 24090 4002 ×¡×”\"×› × ×™×›×•×™×™× 379210 ×¡×›×•× ×‘× × ×§ ×”×ª×—×œ×” ×©×œ # 730 1.00000 0.10000 Hop T 3300 ING OLD × ×ª×•× ×™ ×¢×–×¨ ... ... yaw ng 2 TRDN 6 003 40 3 6 31 40 3 176 a uud 210 ×ª×©×œ×•×ž×™× phen DOR 1095000 109500 61600 3038 15400 ( DVT ) ×ž×©×•×œ×‘ ××•×¤×§ ×—×“×© ×’×ž×•×œ ×—×™× ×•×š ×›×™×ª×” ×§×¦×•×‘×ª × ×¡×™×¢×” ×”×—×–×¨ ×˜×œ×¤×•×Ÿ ×ž×§ × ×¡×™×¢×•×ª ×‘×ª×¤×§ ×¡×”\"×› ×ª×©×œ×•×ž×™× ×© 1284538 1000 15 1522700 2 500 10 : 0 UQLU 60 01 30 09 2008 70 89 01 30 09 2008 ×‘×¨×•×˜×• ×ž×¦×˜×‘×¨ ×œ×ž× . 10859963 9 510300 ×ª××•× ×ž×¡ ×”×›× ×¡×” ×‘×™× ×œ ×§×¨×Ÿ ×”×©×ª 420 Gress\n\nPayslip 2:\n01/06/2017\n01/06/2017\nDN\nWork Days\n186.000 178.00\n22.00\npm me\nCLU\n21.00 TOY SO\n26.88 ve 'un\n21.20\n164.29\n287.08\n000\nGRoss salary\nNet Salery\n5.299.68\n472.37\n4,827.11\n#.827.11\n.ULU\n1.50\n0.42\nMROCL\n0\n×ª×œ×•×© ×ž×©×›×•×¨×ª 6/17\nundi au S\n1055/7 noon 00\n×œ×•×¤×™×\n02 CLU\n572\nCOLO\nGC LACY LO\n103120\n197\n×œ ×œ×ª×©×œ×•×\n1207\njam\n2.73@ bo\n00000000-0\n// 000\n4,784.64\n300.00\n215.04\nAZY!\nSPYY\non'\nGOLL G Anu\nGUB\n0\nco.il\n×©×¨××œ×™ ×™×©×¨××œ×”\nMAIL umud\ncanu\ngown\n26.88\n300.00\n215.04\n1.00\npop on\nang po sa\n13097\n4.785.00\n4.784.07\n0.00\n287.60\n0.00\n207 08\n0.00\n00\nWAIL\n6.336\nALUME\n1000\n6.30\nromanas\nWILL!\nnus ways.\n100\nmye)\nnwotn\n130x0\n5.300.00\n5,299.89\n21.00\n164.00\n287.03\n25% *\n30% T**\n>the 7\n47 wo\n$300.00\n5.300.00\n$00.00\n581.25\n100.48\nALU\n900 129\nwhen\n470121\nCRM\n2.70\n#37 on\n** %\nPO D\n×‘×¨×¢×•×ª\nHealth-Insurance\n06/09/17 200 1\nACL CUCCIO QUILA: 00'000'S act .00 Uhu: 88 92\nadd 14 Â©2001 LIXU ual ca\nCocu MUDELOM T 01/06/2017 01/06/2017 DN Work Days 186.000 178.00 22.00 pm me CLU 21.00 TOY SO 26.88 ve ' un 21.20 164.29 287.08 000 GRoss salary Net Salery 5.299.68 472.37 4,827.11 # .827.11 .ULU 1.50 0.42 MROCL 0 ×ª×œ×•×© ×ž×©×›×•×¨×ª 6/17 undi au S 1055/7 noon 00 ×œ×•×¤×™× 02 CLU 572 COLO GC LACY LO 103120 197 ×œ ×œ×ª×©×œ×•× 1207 jam 2.73 @ bo 00000000-0 // 000 4,784.64 300.00 215.04 AZY ! SPYY on ' GOLL G Anu GUB 0 co.il ×©×¨××œ×™ ×™×©×¨××œ×” MAIL umud canu gown 26.88 300.00 215.04 1.00 pop on ang po sa 13097 4.785.00 4.784.07 0.00 287.60 0.00 207 08 0.00 00 WAIL 6.336 ALUME 1000 6.30 romanas WILL ! nus ways . 100 mye ) nwotn 130x0 5.300.00 5,299.89 21.00 164.00 287.03 25 % * 30 % T ** > the 7 47 wo $ 300.00 5.300.00 $ 00.00 581.25 100.48 ALU 900 129 when 470121 CRM 2.70 # 37 on ** % PO D ×‘×¨×¢×•×ª Health - Insurance 06/09/17 200 1 ACL CUCCIO QUILA : 00'000'S act .00 Uhu : 88 92 add 14 Â© 2001 LIXU ual ca Cocu MUDELOM T\n\nPayslip 3:\nHealth - Insurance\nwork Days.\n×©× ×”×—×‘×¨×”\n×‘×™ ××œ ×¤×™ ××œ×§×˜×¨×•× ×™×§×” ×‘×¢\"×ž\n×ž×¡' ×¢×•×‘×“\n×ž×—×œ×§×”\n3\n0\n×¢×–××’×•×•×™\n×ª×¢×¨×™×£\n×ª×¢×¨×™×£ ×™×•×\n6,000.00\n276.88\n32.97\n×ª××•×¨ ×”×ª×©×œ×•×\n×›×ž×•×ª\n×©×›×¨ ×™×¡×•×“\n1.00\n××™× ×¤×•×¨×ž×˜×™×‘×™ - ×©×›×¨ ×ž×™× ×™×ž×•× ×œ×—×•×“×©\n××™× ×¤×•×¨×ž×˜×™×‘×™- ×©×›×¨ ×ž×™× ×™×ž×•× ×œ×©×¢×”\n× ×™×›×•×™×™ ×—×•×‘×”\n×‘×™×˜×•×— ×œ××•×ž×™\n×“×ž×™ ×‘×¨×™××•×ª\n×¡×”\"×›\n×ª×œ×•×© ×ž×©×›×•×¨×ª ×œ×—×•×“×©\n1/2020\n×›×ª×•×‘×ª: × ×—×œ×ª ×”×¨ ×—×‘\"×“ 144, ×§×¨×™×™×ª ×ž×œ××›×™ 8303300\n×ª×™×§ × ×™×›×•×™×™×\n×‘.×œ\n×ž.×”\n951617638\n951617638\n×ž×¡×¤×¨ ×ª××’×™×“ - 515919595\n×©× ×¢×•×‘×“\n×–×œ×ž×Ÿ ×©×ž×¢×•×Ÿ\n×ª×¢×•×“×ª ×–×”×•×ª\n×ª×ª ×ž×—×œ×§×”\n×“×¨×•×’\n×“×¨×’×”\n×•×ª\n×ª×—×™×œ×ª ×¢×‘×•×“×”\n302762729\n01/08/19\n×ª×¢×¨×™×£ ×©×¢×” ×™×ž×™ ×¢×‘×•×“×” ×©×¢×•×ª ×¢×‘×•×“×” ×‘× ×§\n×¡× ×™×£\n×—×©×‘×•×Ÿ\n21.67\n182\n×ª×¢×¨×™×£\n××—×•×–\n× ×˜×• ×œ×’×™×œ×•×\n×ž×©×•×œ× ×œ×¢×•×‘×“\n×¡×›×•× ×”×ª×©×œ×•×\n6.000.00\n6,000.00\n×¤×™×¦×•×™×™× ×—×•×“×©×™\n×¤×™×¦×•×™×™× ×¤×˜×•×¨\n×¤×™×¦×•×™×™× ×•×ª×™×§×”\n×©×›×¨ ×œ×¤×™×¦×•×™×™×\n×§×•×¤\"×’ ×ž×¢×‘×™×“-×—×•×“×©×™ 0.00\n×©×›×¨ ×œ×§×•×¤\"×’\n0.00\n×§×”\"×œ ×ž×¢×‘×™×“-×—×•×“×©×™ :0.00\n×©×›×¨ ×œ×§×”×™×œ\n0.00:\n×ž×¦×‘\n]\n×‘×Ÿ ×–×•×’\n× ×•×©×¤×—×ª×™ ×¢×•×‘×“\n×’\n. ×–×™×›×•×™\n4.75\n×ž×¡ ×©×•×œ×™ % ×ž×¡ ×§×‘×•×¢\n0.00 :\n0.00 :\n0.00 :\n0.00\n××—×•×– ×ž×©×¨×”\n×–×™×›×•×™ ××™×©×™\n10.00\n×–×™×›×•×™ ×›×¡×£\n×–×™×›×•×™ ×’×ž×œ\n1,040\n×™×˜×™ ×ž×©×ž×¨×•×ª\n×¤×˜×•×¨ ×—×•×“×©×™\n×¤×˜×¨ ×¡ 47\n×”× ×—×ª\n×™×©×•×‘×™ ×¤×™×ª×•×ª\n×ª××•×\n×œ\n×©×›×¨ ×œ×ª××•×\n×ž.×”. ×œ×ª××•×\n×—×™×™×‘ ×ž.×”.\n×—×™×™×‘ ×‘.×œ.\n5300\n29.12\n×™×ž×™ ×ª×§×Ÿ\n×©×¢×•×ª ×ª×§×Ÿ\n21.67\n182.00\n×¡×”\"×› ×ª×©×œ×•×ž×™×\n×”×¡×›×•×\n× ×™×›×•×™×™ ×¨×©×•×ª\n×™×ª×¨×”\n×›×ž×•×ª\n×¡×›×•×\n24.00\n186.00\n210.00\n×¡×”\"×›\n×”×¢×¨×•×ª:\n× ×™×”×•×œ ×”×¢×“×¨×•×™×•×ª\n×™×ª×¨×” ×§×•×“×ž×ª\n×¡×•×’ ×”×¢×“×—×ª\n× ×™×¦×•×œ\n×™×ª×¨×”\n×ª×©×œ×•×ž×™×\n×©×›×¨ ×©×•×•×” ×›×¡×£\n×—×•×¤×©\n×—×™×™×‘ ×ž×”.\n×ž×¡ ×”×˜×¡×”\n×‘×˜×•×— ×œ××•×ž×™\n×—×•×“×©×™\n×¢×‘×•×“×”\n1 2 3 4 5 6 7 8 91 1 1\n×‘×•×¦×¢ ×¢×™×™×œ: ××‘×™× ×•×¢× ×ž×©×” - ×¨×•××” ×—×©×‘×•×Ÿ\n×’×ž×œ 35%\n×’ ×”×©×ª×œ×ž×•×ª\n6,000\n6,000\n210\n× ×ª×•× ×™× ×ž×¦×˜×‘×¨×™×\n×›×™×›×•×™ ×¡ 47\n×–×™×›×•×™ ××™×©×™\n1,040\n×–×™×›×•×™ × ×•×¡×£\n×–×™×›×•×™ ×’×ž×œ\n×“×ž×™ ×—×‘×¨ ×˜×™×¤×•×œ\n×—×™×™×‘ ×‘.×œ.\n×§×•×¤×™×’ ×ž×¢×‘×™×“\n×§×”×™×œ ×ž×¢×‘×™×¨\n×–×™×›×•×™ ×ž×©×ž×¨×•×ª\n×¤×™×¦×•×™×™× ×ž×¢×¡×™×§\n×¤×˜×•×¨\n×¤×˜×•×¨ 476\n×‘×ª××¨×™×š\n0\n05/02/2020\n×¡×”\"×› × ×™×›×•×™×™×\n×©×›×¨ × ×˜×•\n× ×˜×• ×œ×ª×©×œ×•×\n6,000\n0.00\n0.00\n0.00\n6,000.00\n6,000.00\n6,000.00\n210.00\n5,790.00\n5,790.00\n×‘××ž×¦×¢×•×ª ×©×™×§×œ×•×œ×™×ª ×ž×‘×™×ª ×˜.×ž.×œ. - ×ª×•×›× ×ª ×”×©×›×¨ ×”×ž×•×‘×™×œ×” ×‘×ž×“×™× ×”\nGROSS-22\nNet Salary Health - Insurance work Days . ×©× ×”×—×‘×¨×” ×‘×™ ××œ ×¤×™ ××œ×§×˜×¨×•× ×™×§×” ×‘×¢\"×ž ×ž×¡ ' ×¢×•×‘×“ ×ž×—×œ×§×” 3 0 ×¢×–××’×•×•×™ ×ª×¢×¨×™×£ ×ª×¢×¨×™×£ ×™×•× 6,000.00 276.88 32.97 ×ª××•×¨ ×”×ª×©×œ×•× ×›×ž×•×ª ×©×›×¨ ×™×¡×•×“ 1.00 ××™× ×¤×•×¨×ž×˜×™×‘×™ - ×©×›×¨ ×ž×™× ×™×ž×•× ×œ×—×•×“×© ××™× ×¤×•×¨×ž×˜×™×‘×™- ×©×›×¨ ×ž×™× ×™×ž×•× ×œ×©×¢×” × ×™×›×•×™×™ ×—×•×‘×” ×‘×™×˜×•×— ×œ××•×ž×™ ×“×ž×™ ×‘×¨×™××•×ª ×¡×”\"×› ×ª×œ×•×© ×ž×©×›×•×¨×ª ×œ×—×•×“×© 1/2020 ×›×ª×•×‘×ª : × ×—×œ×ª ×”×¨ ×—×‘\"×“ 144 , ×§×¨×™×™×ª ×ž×œ××›×™ 8303300 ×ª×™×§ × ×™×›×•×™×™× ×‘.×œ ×ž.×” 951617638 951617638 ×ž×¡×¤×¨ ×ª××’×™×“ - 515919595 ×©× ×¢×•×‘×“ ×–×œ×ž×Ÿ ×©×ž×¢×•×Ÿ ×ª×¢×•×“×ª ×–×”×•×ª ×ª×ª ×ž×—×œ×§×” ×“×¨×•×’ ×“×¨×’×” ×•×ª ×ª×—×™×œ×ª ×¢×‘×•×“×” 302762729 01/08/19 ×ª×¢×¨×™×£ ×©×¢×” ×™×ž×™ ×¢×‘×•×“×” ×©×¢×•×ª ×¢×‘×•×“×” ×‘× ×§ ×¡× ×™×£ ×—×©×‘×•×Ÿ 21.67 182 ×ª×¢×¨×™×£ ××—×•×– × ×˜×• ×œ×’×™×œ×•× ×ž×©×•×œ× ×œ×¢×•×‘×“ ×¡×›×•× ×”×ª×©×œ×•× 6.000.00 6,000.00 ×¤×™×¦×•×™×™× ×—×•×“×©×™ ×¤×™×¦×•×™×™× ×¤×˜×•×¨ ×¤×™×¦×•×™×™× ×•×ª×™×§×” ×©×›×¨ ×œ×¤×™×¦×•×™×™× ×§×•×¤\"×’ ×ž×¢×‘×™×“ - ×—×•×“×©×™ 0.00 ×©×›×¨ ×œ×§×•×¤\"×’ 0.00 ×§×”\"×œ ×ž×¢×‘×™×“ - ×—×•×“×©×™ : 0.00 ×©×›×¨ ×œ×§×”×™×œ 0.00 : ×ž×¦×‘ ] ×‘×Ÿ ×–×•×’ × ×•×©×¤×—×ª×™ ×¢×•×‘×“ ×’ . ×–×™×›×•×™ 4.75 ×ž×¡ ×©×•×œ×™ % ×ž×¡ ×§×‘×•×¢ 0.00 : 0.00 : 0.00 : 0.00 ××—×•×– ×ž×©×¨×” ×–×™×›×•×™ ××™×©×™ 10.00 ×–×™×›×•×™ ×›×¡×£ ×–×™×›×•×™ ×’×ž×œ 1,040 ×™×˜×™ ×ž×©×ž×¨×•×ª ×¤×˜×•×¨ ×—×•×“×©×™ ×¤×˜×¨ ×¡ 47 ×”× ×—×ª ×™×©×•×‘×™ ×¤×™×ª×•×ª ×ª××•× ×œ ×©×›×¨ ×œ×ª××•× ×ž.×”. ×œ×ª××•× ×—×™×™×‘ ×ž.×”. ×—×™×™×‘ ×‘.×œ. 5300 29.12 ×™×ž×™ ×ª×§×Ÿ ×©×¢×•×ª ×ª×§×Ÿ 21.67 182.00 ×¡×”\"×› ×ª×©×œ×•×ž×™× ×”×¡×›×•× × ×™×›×•×™×™ ×¨×©×•×ª ×™×ª×¨×” ×›×ž×•×ª ×¡×›×•× 24.00 186.00 210.00 ×¡×”\"×› ×”×¢×¨×•×ª : × ×™×”×•×œ ×”×¢×“×¨×•×™×•×ª ×™×ª×¨×” ×§×•×“×ž×ª ×¡×•×’ ×”×¢×“×—×ª × ×™×¦×•×œ ×™×ª×¨×” ×ª×©×œ×•×ž×™× ×©×›×¨ ×©×•×•×” ×›×¡×£ ×—×•×¤×© ×—×™×™×‘ ×ž×” . ×ž×¡ ×”×˜×¡×” ×‘×˜×•×— ×œ××•×ž×™ ×—×•×“×©×™ ×¢×‘×•×“×” 1 2 3 4 5 6 7 8 91 1 1 ×‘×•×¦×¢ ×¢×™×™×œ : ××‘×™× ×•×¢× ×ž×©×” - ×¨×•××” ×—×©×‘×•×Ÿ ×’×ž×œ 35 % ×’ ×”×©×ª×œ×ž×•×ª 6,000 6,000 210 × ×ª×•× ×™× ×ž×¦×˜×‘×¨×™× ×›×™×›×•×™ ×¡ 47 ×–×™×›×•×™ ××™×©×™ 1,040 ×–×™×›×•×™ × ×•×¡×£ ×–×™×›×•×™ ×’×ž×œ ×“×ž×™ ×—×‘×¨ ×˜×™×¤×•×œ ×—×™×™×‘ ×‘.×œ. ×§×•×¤×™×’ ×ž×¢×‘×™×“ ×§×”×™×œ ×ž×¢×‘×™×¨ ×–×™×›×•×™ ×ž×©×ž×¨×•×ª ×¤×™×¦×•×™×™× ×ž×¢×¡×™×§ ×¤×˜×•×¨ ×¤×˜×•×¨ 476 ×‘×ª××¨×™×š 0 05/02/2020 ×¡×”\"×› × ×™×›×•×™×™× ×©×›×¨ × ×˜×• × ×˜×• ×œ×ª×©×œ×•× 6,000 0.00 0.00 0.00 6,000.00 6,000.00 6,000.00 210.00 5,790.00 5,790.00 ×‘××ž×¦×¢×•×ª ×©×™×§×œ×•×œ×™×ª ×ž×‘×™×ª ×˜.×ž.×œ. - ×ª×•×›× ×ª ×”×©×›×¨ ×”×ž×•×‘×™×œ×” ×‘×ž×“×™× ×” GROSS - 22 Net Salary\n\nPayslip 4:\nWork Deys\n×©× ×”×—×‘×¨×”\n×”×ž×©×© ×”×©×§×™×•×ª ×‘×œ×\n×ª.×“ 8\n×ž×¡' ×¢×•×‘×“\n×ž×—×œ×§×”\n×ª×œ×•×© ×ž×©×›×•×¨×ª ×œ×—×•×“×© 5/2024\n×›×ª×•×‘×ª:\n× ×—×œ ×©×©×‘×¨×ª:2, ××™×œ×ª\n×ž×—×œ×§×”: × ×ž×•×™ ×ž×™× ×™×ž×•×\n×©× ×¢×•×‘×“\n×ª×¢×•×“×ª ×–×”×•×ª\n×ª×ª ×ž×—×œ×§×”\n×“×¨×•×’\n×“×¨×’×”\n1.70\n4\n×ª×¢×¨×™×£\n×ª×¢×¨×™×£ ×™×•×\n×ª×¢×¨×™×£ ×©×¢×” ×™×ž×™ ×¢×‘×•×“×” ×©×¢×•×ª ×¢×‘×•×“×”\n×‘× ×§\n×¡× ×™×£\n×—×©×‘×•×Ÿ\n×¤×™×¦×•×™×™× ×—×•×“×©×™\n6,500.00\n250\n32.5\n26\n0/200\n12\n763\n×¤×™×¦×•×™×™× ×¤×˜×•×¨\n×ž×©×•×œ×ž×•×ª / ×‘×¤×•×¢×œ\n×ž×©×•×œ× ×œ×¢×•×‘×“\n03/04/24%\n0.00:\n0.00 :\n29\n1\n×‘.×œ\n×ž.×”\n×ª×™×§ × ×™×›×•×™×™×\n940095489\n×ž×¡×¤×¨ ×ª××’×™×“ - 514730795\n×•×•×ª×§ ×ª×—×™×œ×ª ×¢×‘×•×“×”\n×—×©\n×ª××•×¨ ×”×ª×©×œ×•×\n×›×ž×•×ª\n×ª×¢×¨×™×£\n××—×•×–\n× ×˜×• ×œ×’×™×œ×•×\n×¤×™×¦×•×™×™× ×•×ª×™×§×”\n×¡×›×•× ×”×ª×©×œ×•×\n×©×›×¨ ×™×¡×•×“\n×™×ž×™ ×—×’\n×©×¢×•×ª × ×•×¡×¤×•×ª ×’×œ×•×‘×œ×™×•×ª\n×©×¢×•×ª ×©×‘×ª\n6,500.00\n1.00\n250.00\n1.00\n500.00\n1.00\n1,500.00\n1.00\n×©×›×¨ ×œ×¤×™×¦×•×™×™×\n6,500.00\n250.00\n500.00\n1,500.00\n×§×•×¤\"×’ ×ž×¢×¡×™×§-×—×•×“×©×™\n×©×›×¨ ×œ×§×•×¤×™×™×’\n×©×›×¨ ×œ×§×”×™×™×œ\n×§×”×™×œ ×ž×¢×¡×™×§-×—×•×“×©×™\n×ž×¦×‘\n×‘×Ÿ ×–×•×’\n×ž×©×¤×—×ª×™×Ÿ ×¢×•×‘×“\n× ×›\n× . ×–×™×›×•×™\n2.25\n×ž×¡ ×©×•×œ×™ % ×ž×¡ ×§×‘×•×¢\n14.00\n×–×™×›×•×™ × ×•×¡×£\n0.00\n××—×•×– ×ž×©×¨×”\n×–×™×›×•×™ ××™×©×™\n544\n×–×™×›×•×™ ×’×ž×œ ×–×™×›×•×™ ×ž×©×ž×¨×•×ª\n0.00:\n0.00\n0.00\n0.00\n0.00:\novertime Hours\n××™× ×¤×•×¨×ž×˜×™×‘×™ - ×©×›×¨ ×ž×™× ×™×ž×•× ×œ×—×•×“×©\n××™× ×¤×•×¨×ž×˜×™×‘×™ - ×©×›×¨ ×ž×™× ×™×ž×•× ×œ×©×¢×”\n× ×™×›×•×™×™ ×—×•×‘×”\n×‘×™×˜×•×— ×œ××•×ž×™\n×“×ž×™ ×‘×¨×™××•×ª\n×¤×˜×•×¨ ×—×•×“×©×™\n×¤×˜×•×¨ ×¡' 47\n×”× ×—×ª\n×™×©×•×‘×™ ×¤×™×ª×•×—\n875\n×©×›×¨ ×œ×ª××•×\n×ž.×”. ×œ×ª××•×\n×ª××•×\n×ž×¡\n×œ\n×—×™×™×‘ ×ž.×”.\n×—×™×™×‘ ×‘.×œ.\n5880.02\n32.3\n:\n:\n×™×ž×™ ×ª×§×Ÿ\n×©×¢×•×ª ×ª×§×Ÿ\n26.00\n200.00\nâ€žGross Balary\n×¡×”\"×› ×ª×©×œ×•×ž×™×\n×”×¡×›×•×\n× ×™×›×•×™×™ ×¨×©×•×ª\n×™×ª×¨×”\n×›×ž×•×ª\n×¡×›×•×ž\n116.00\n295.00\nHealth Insurance\n×¡×”\"×›\n411.00\n×”×¢×¨×•×ª:\n× ×™×”×•×œ ×”×¢×“×¨×•×™×•×ª\n×¡×•×’ ×”×¢×“×¨×•×ª ×™×ª×¨×” ×§×•×“×ž×ª\n× ×™×¦×•×œ\n×™×ª×¨×”\n×—×•×¤×©\n0\n1.17\n2.33\n×ž×—×œ×”\n×¦×‘×™×¨×ª ×—×•×¤×©\n×¦×‘×™×¨×ª ×ž×—×œ×”\n0\n0\n1.17:\n1.5:\n1.5\n×¡×”\"×›\n×ª×©×œ×•×ž×™×\n×©×›×¨ ×©×•×•×” ×›×¡×£\n×—×™×™×‘ ×ž.×”.\n×ž×¡ ×”×›× ×¡×”\n×‘×™×˜×•×— ×œ××•×ž×™\n×—×•×“×©×™\n×¢ ×‘ ×• ×“ ×”\n1 2 3 4 5 6 7 8 9 101112\n×’×ž×œ 35%\n×§. ×”×©×ª×œ×ž×•×ª\n×› ×› ×œ ×œ ×œ\n18,850\n300\n19,150\n1,020\n×¡×”\"×› × ×™×›×•×™×™×\nNet salary\n× ×ª×•× ×™× ×ž×¦×˜×‘×¨×™×\n× ×™×›×•×™ ×¡' 47\n×“×ž×™ ×—×‘×¨/×˜×™×¤×•×œ\n×–×™×›×•×™ ××™×©×™\n×–×™×›×•×™ × ×•×¡×£\n×–×™×›×•×™ ×’×ž×œ\n×–×™×›×•×™ ×ž×©×ž×¨×•×ª\n1,089\n×—×™×™×‘ ×‘.×œ.\n×§×•×¤×™'×’ ×ž×¢×¡×™×§\n×§×”×™×™×œ ×ž×¢×¡×™×§\n×¤×™×¦×•×™×™× ×ž×¢×¡×™×§\n×¤×˜×•×¨\n×¤×˜×•×¨ ×¡' 47\n0\n0\n×‘×ª××¨×™×š 09/06/2024\n×©×›×¨ × ×˜×•\n× ×˜×Ÿ ×œ×ª×©×œ×•×\n19,150\n0.00\n0.00\n0.00\n8,750.00\n8,750.00\n8,750.00\n411.00\n8,339.00\n8,339.00 Work Deys ×©× ×”×—×‘×¨×” ×”×ž×©×© ×”×©×§×™×•×ª ×‘×œ× ×ª.×“ 8 ×ž×¡ ' ×¢×•×‘×“ ×ž×—×œ×§×” ×ª×œ×•×© ×ž×©×›×•×¨×ª ×œ×—×•×“×© 5/2024 ×›×ª×•×‘×ª : × ×—×œ ×©×©×‘×¨×ª : 2 , ××™×œ×ª ×ž×—×œ×§×” : × ×ž×•×™ ×ž×™× ×™×ž×•× ×©× ×¢×•×‘×“ ×ª×¢×•×“×ª ×–×”×•×ª ×ª×ª ×ž×—×œ×§×” ×“×¨×•×’ ×“×¨×’×” 1.70 4 ×ª×¢×¨×™×£ ×ª×¢×¨×™×£ ×™×•× ×ª×¢×¨×™×£ ×©×¢×” ×™×ž×™ ×¢×‘×•×“×” ×©×¢×•×ª ×¢×‘×•×“×” ×‘× ×§ ×¡× ×™×£ ×—×©×‘×•×Ÿ ×¤×™×¦×•×™×™× ×—×•×“×©×™ 6,500.00 250 32.5 26 0/200 12 763 ×¤×™×¦×•×™×™× ×¤×˜×•×¨ ×ž×©×•×œ×ž×•×ª / ×‘×¤×•×¢×œ ×ž×©×•×œ× ×œ×¢×•×‘×“ 03 / 04 / 24 % 0.00 : 0.00 : 29 1 ×‘.×œ ×ž.×” ×ª×™×§ × ×™×›×•×™×™× 940095489 ×ž×¡×¤×¨ ×ª××’×™×“ - 514730795 ×•×•×ª×§ ×ª×—×™×œ×ª ×¢×‘×•×“×” ×—×© ×ª××•×¨ ×”×ª×©×œ×•× ×›×ž×•×ª ×ª×¢×¨×™×£ ××—×•×– × ×˜×• ×œ×’×™×œ×•× ×¤×™×¦×•×™×™× ×•×ª×™×§×” ×¡×›×•× ×”×ª×©×œ×•× ×©×›×¨ ×™×¡×•×“ ×™×ž×™ ×—×’ ×©×¢×•×ª × ×•×¡×¤×•×ª ×’×œ×•×‘×œ×™×•×ª ×©×¢×•×ª ×©×‘×ª 6,500.00 1.00 250.00 1.00 500.00 1.00 1,500.00 1.00 ×©×›×¨ ×œ×¤×™×¦×•×™×™× 6,500.00 250.00 500.00 1,500.00 ×§×•×¤\"×’ ×ž×¢×¡×™×§ - ×—×•×“×©×™ ×©×›×¨ ×œ×§×•×¤×™×™×’ ×©×›×¨ ×œ×§×”×™×™×œ ×§×”×™×œ ×ž×¢×¡×™×§ - ×—×•×“×©×™ ×ž×¦×‘ ×‘×Ÿ ×–×•×’ ×ž×©×¤×—×ª×™×Ÿ ×¢×•×‘×“ × ×› ×  . ×–×™×›×•×™ 2.25 ×ž×¡ ×©×•×œ×™ % ×ž×¡ ×§×‘×•×¢ 14.00 ×–×™×›×•×™ × ×•×¡×£ 0.00 ××—×•×– ×ž×©×¨×” ×–×™×›×•×™ ××™×©×™ 544 ×–×™×›×•×™ ×’×ž×œ ×–×™×›×•×™ ×ž×©×ž×¨×•×ª 0.00 : 0.00 0.00 0.00 0.00 : overtime Hours ××™× ×¤×•×¨×ž×˜×™×‘×™ - ×©×›×¨ ×ž×™× ×™×ž×•× ×œ×—×•×“×© ××™× ×¤×•×¨×ž×˜×™×‘×™ - ×©×›×¨ ×ž×™× ×™×ž×•× ×œ×©×¢×” × ×™×›×•×™×™ ×—×•×‘×” ×‘×™×˜×•×— ×œ××•×ž×™ ×“×ž×™ ×‘×¨×™××•×ª ×¤×˜×•×¨ ×—×•×“×©×™ ×¤×˜×•×¨ ×¡ ' 47 ×”× ×—×ª ×™×©×•×‘×™ ×¤×™×ª×•×— 875 ×©×›×¨ ×œ×ª××•× ×ž.×”. ×œ×ª××•× ×ª××•× ×ž×¡ ×œ ×—×™×™×‘ ×ž.×”. ×—×™×™×‘ ×‘.×œ. 5880.02 32.3 : : ×™×ž×™ ×ª×§×Ÿ ×©×¢×•×ª ×ª×§×Ÿ 26.00 200.00 â€ž Gross Balary ×¡×”\"×› ×ª×©×œ×•×ž×™× ×”×¡×›×•× × ×™×›×•×™×™ ×¨×©×•×ª ×™×ª×¨×” ×›×ž×•×ª ×¡×›×•×ž 116.00 295.00 Health Insurance ×¡×”\"×› 411.00 ×”×¢×¨×•×ª : × ×™×”×•×œ ×”×¢×“×¨×•×™×•×ª ×¡×•×’ ×”×¢×“×¨×•×ª ×™×ª×¨×” ×§×•×“×ž×ª × ×™×¦×•×œ ×™×ª×¨×” ×—×•×¤×© 0 1.17 2.33 ×ž×—×œ×” ×¦×‘×™×¨×ª ×—×•×¤×© ×¦×‘×™×¨×ª ×ž×—×œ×” 0 0 1.17 : 1.5 : 1.5 ×¡×”\"×› ×ª×©×œ×•×ž×™× ×©×›×¨ ×©×•×•×” ×›×¡×£ ×—×™×™×‘ ×ž.×”. ×ž×¡ ×”×›× ×¡×” ×‘×™×˜×•×— ×œ××•×ž×™ ×—×•×“×©×™ ×¢ ×‘ ×• ×“ ×” 1 2 3 4 5 6 7 8 9 101112 ×’×ž×œ 35 % ×§ . ×”×©×ª×œ×ž×•×ª ×› ×› ×œ ×œ ×œ 18,850 300 19,150 1,020 ×¡×”\"×› × ×™×›×•×™×™× Net salary × ×ª×•× ×™× ×ž×¦×˜×‘×¨×™× × ×™×›×•×™ ×¡ ' 47 ×“×ž×™ ×—×‘×¨ / ×˜×™×¤×•×œ ×–×™×›×•×™ ××™×©×™ ×–×™×›×•×™ × ×•×¡×£ ×–×™×›×•×™ ×’×ž×œ ×–×™×›×•×™ ×ž×©×ž×¨×•×ª 1,089 ×—×™×™×‘ ×‘.×œ. ×§×•×¤×™'×’ ×ž×¢×¡×™×§ ×§×”×™×™×œ ×ž×¢×¡×™×§ ×¤×™×¦×•×™×™× ×ž×¢×¡×™×§ ×¤×˜×•×¨ ×¤×˜×•×¨ ×¡ ' 47 0 0 ×‘×ª××¨×™×š 09/06/2024 ×©×›×¨ × ×˜×• × ×˜×Ÿ ×œ×ª×©×œ×•× 19,150 0.00 0.00 0.00 8,750.00 8,750.00 8,750.00 411.00 8,339.00 8,339.00\n\nPayslip 5:\nIn Hebrew\n×©×›×¨ ×‘×¨×•×˜×•\n× ×™×›×•×™ ×ž×¡ ×”×›× ×¡×”\n×”×¤×¨×©×” ×œ×¤× ×¡×™×”.\n×‘×™×˜×•×— ×‘×¨×™××•×ª\n×©×›×¨ × ×˜×¨\n×™×ž×™ ×¢×‘×•×“×”\n×©×¢×•×ª × ×•×¡×¤×•×ª\nDescription in English\nGroes Salary\nIncome Tax Deduction\nPension Contribution\nHealth Insurance\nNet Salary\nWork: Days\nOvertime Hours\nvalue/ ×¢×¨×š\n×©×™×— 5,200\n×©\"×— 300\n6%\n×©\"×— 150\n×©\"×— 4,500\n22\n0 In Hebrew ×©×›×¨ ×‘×¨×•×˜×• × ×™×›×•×™ ×ž×¡ ×”×›× ×¡×” ×”×¤×¨×©×” ×œ×¤× ×¡×™×” . ×‘×™×˜×•×— ×‘×¨×™××•×ª ×©×›×¨ × ×˜×¨ ×™×ž×™ ×¢×‘×•×“×” ×©×¢×•×ª × ×•×¡×¤×•×ª Description in English Groes Salary Income Tax Deduction Pension Contribution Health Insurance Net Salary Work : Days Overtime Hours value / ×¢×¨×š ×©×™×— 5,200 ×©\"×— 300 6 % ×©\"×— 150 ×©\"×— 4,500 22 0\n\nPayslip 6:\n×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 11/2024\n×¤×¨×˜×™ ×”×ž×¢×¡×™×§ :×¢×¡×§×™× ×‘×¢\"×ž\n×¤×¨×˜×™ ×”×¢×•×‘×“ :×™×©×¨××œ ×™×©×¨××œ×™ ×ª.×– :123456789 ×›×ª×•×‘×ª :×©×œ×•× ×œ×›×\n:×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™×\n×©×›×¨ ×™×¡×•×“ :6000.00 -\nâ‚ª ×“×ž×™ × ×¡×™×¢×•×ª :250.00 -\n×©×¢×•×ª × ×•×¡×¤×•×ª 12 ×©×¢×•×ª :(0.00 -\nâ‚ª ×¡×”\"×› ×‘×¨×•×˜×• :6250.00\n×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª\nâ‚ª 390.00 :(6.5%) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” -\nâ‚ª 186.00 :(3.1%) ×‘×™×˜×•×— ×‘×¨×™××•×ª\nâ‚ª 420.00 :(7%) ×‘×™×˜×•×— ×œ××•×ž×™ -\n×¡×”\"×› × ×™×›×•×™×™× :996.00\nâ‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** :5254.00** ×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 11/2024 ×¤×¨×˜×™ ×”×ž×¢×¡×™×§ : ×¢×¡×§×™× ×‘×¢\"×ž ×¤×¨×˜×™ ×”×¢×•×‘×“ : ×™×©×¨××œ ×™×©×¨××œ×™ ×ª.×– : 123456789 ×›×ª×•×‘×ª : ×©×œ×•× ×œ×›× : ×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™× ×©×›×¨ ×™×¡×•×“ : 6000.00 - â‚ª ×“×ž×™ × ×¡×™×¢×•×ª : 250.00 - ×©×¢×•×ª × ×•×¡×¤×•×ª 12 ×©×¢×•×ª : ( 0.00 - â‚ª ×¡×”\"×› ×‘×¨×•×˜×• : 6250.00 ×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª â‚ª 390.00 : ( 6.5 % ) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” - â‚ª 186.00 : ( 3.1 % ) ×‘×™×˜×•×— ×‘×¨×™××•×ª â‚ª 420.00 : ( 7 % ) ×‘×™×˜×•×— ×œ××•×ž×™ - ×¡×”\"×› × ×™×›×•×™×™× : 996.00 â‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** : 5254.00 **\n\nPayslip 7:\n×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 12/2024\n×¤×¨×˜×™ ×”×ž×¢×¡×™×§ :×¢×¡×§×™× ×‘×¢''×ž\n×¤×¨×˜×™ ×”×¢×•×‘×“ :×™×©×¨××œ ×™×©×¨××œ×™ ×ª.×– :123456789,×›×ª×•×‘×ª :×©×œ×•× ×œ×›×\n:×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™×\n×©×›×¨ ×™×¡×•×“ :6000.00 -\n×“×ž×™ × ×¡×™×¢×•×ª :250.00 -\n-\n×©×¢×•×ª × ×•×¡×¤×•×ª )12 ×©×¢×•×ª :(600.00 -\n×¡×”\"×› ×‘×¨×•×˜×• :6850.00\n:×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª\nâ‚ª 0.00 :(6.5%) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” -\nâ‚ª 186.00 :(3.1%) ×‘×™×˜×•×— ×‘×¨×™××•×ª -\nâ‚ª 420.00 :(7%) ×‘×™×˜×•×— ×œ××•×ž×™ -\n×¡×”\"×› × ×™×›×•×™×™× :606.00\nâ‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** :6244.00** ×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 12/2024 ×¤×¨×˜×™ ×”×ž×¢×¡×™×§ : ×¢×¡×§×™× ×‘×¢''×ž ×¤×¨×˜×™ ×”×¢×•×‘×“ : ×™×©×¨××œ ×™×©×¨××œ×™ ×ª.×– : 123456789 , ×›×ª×•×‘×ª : ×©×œ×•× ×œ×›× : ×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™× ×©×›×¨ ×™×¡×•×“ : 6000.00 - ×“×ž×™ × ×¡×™×¢×•×ª : 250.00 - - ×©×¢×•×ª × ×•×¡×¤×•×ª ) 12 ×©×¢×•×ª : ( 600.00 - ×¡×”\"×› ×‘×¨×•×˜×• : 6850.00 : ×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª â‚ª 0.00 : ( 6.5 % ) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” - â‚ª 186.00 : ( 3.1 % ) ×‘×™×˜×•×— ×‘×¨×™××•×ª - â‚ª 420.00 : ( 7 % ) ×‘×™×˜×•×— ×œ××•×ž×™ - ×¡×”\"×› × ×™×›×•×™×™× : 606.00 â‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** : 6244.00 **\n\nPayslip 8:\n×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 01/2025\n×¤×¨×˜×™ ×”×ž×¢×¡×™×§ :×¢×¡×§×™× ×‘×¢''×ž\n×¤×¨×˜×™ ×”×¢×•×‘×“ :×™×©×¨××œ ×™×©×¨××œ×™,×ª.×– :123456789,×›×ª×•×‘×ª :×©×œ×•× ×œ×›×\n:×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™×\n×©×›×¨ ×™×¡×•×“ :6000.00 -\n×“×ž×™ × ×¡×™×¢×•×ª :250.00\n-\n×©×¢×•×ª × ×•×¡×¤×•×ª )12 ×©×¢×•×ª :(600.00 -\nâ‚ª ×¡×”\"×› ×‘×¨×•×˜×• :6850.00\n-\n:×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª\nâ‚ª 390.00 :(6.5%) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” -\nâ‚ª 186.00 :(3.16) ×‘×™×˜×•×— ×‘×¨×™××•×ª -\nâ‚ª 420.00 ;(7%) ×‘×™×˜×•×— ×œ××•×ž×™\n×¡×”\"×› × ×™×›×•×™×™× :996.00\n-O\nâ‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** :5854.00** ×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 01/2025 ×¤×¨×˜×™ ×”×ž×¢×¡×™×§ : ×¢×¡×§×™× ×‘×¢''×ž ×¤×¨×˜×™ ×”×¢×•×‘×“ : ×™×©×¨××œ ×™×©×¨××œ×™ , ×ª.×– : 123456789 , ×›×ª×•×‘×ª : ×©×œ×•× ×œ×›× : ×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™× ×©×›×¨ ×™×¡×•×“ : 6000.00 - ×“×ž×™ × ×¡×™×¢×•×ª : 250.00 - ×©×¢×•×ª × ×•×¡×¤×•×ª ) 12 ×©×¢×•×ª : ( 600.00 - â‚ª ×¡×”\"×› ×‘×¨×•×˜×• : 6850.00 - : ×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª â‚ª 390.00 : ( 6.5 % ) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” - â‚ª 186.00 : ( 3.16 ) ×‘×™×˜×•×— ×‘×¨×™××•×ª - â‚ª 420.00 ; ( 7 % ) ×‘×™×˜×•×— ×œ××•×ž×™ ×¡×”\"×› × ×™×›×•×™×™× : 996.00 -O â‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** : 5854.00 **\n\nPayslip 9:\n×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 02/2025\n×¤×¨×˜×™ ×”×ž×¢×¡×™×§ :×¢×¡×§×™× ×‘×¢''×ž\n×¤×¨×˜×™ ×”×¢×•×‘×“ :×™×©×¨××œ ×™×©×¨××œ×™ ×ª.×– :123456789 ×›×ª×•×‘×ª :×©×œ×•× ×œ×›×\n:×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™×\n×©×›×¨ ×™×¡×•×“ :6000.00 -\n×“×ž×™ × ×¡×™×¢×•×ª :0.00 -\n-\nâ‚ª ×©×¢×•×ª × ×•×¡×¤×•×ª 12 ×©×¢×•×ª :(600.00 -\n×¡×”\"×› ×‘×¨×•×˜×• :6600.00\n:×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª\nâ‚ª 390.00 :(6.5%) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” -\n186.00â‚ª :(3.1%) ×‘×™×˜×•×— ×‘×¨×™××•×ª -\nâ‚ª 420.00 :(7%) ×‘×™×˜×•×— ×œ××•×ž×™ -\n×¡×”\"×› × ×™×›×•×™×™× :996.00\nâ‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** :5604.00** ×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 02/2025 ×¤×¨×˜×™ ×”×ž×¢×¡×™×§ : ×¢×¡×§×™× ×‘×¢''×ž ×¤×¨×˜×™ ×”×¢×•×‘×“ : ×™×©×¨××œ ×™×©×¨××œ×™ ×ª.×– : 123456789 ×›×ª×•×‘×ª : ×©×œ×•× ×œ×›× : ×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™× ×©×›×¨ ×™×¡×•×“ : 6000.00 - ×“×ž×™ × ×¡×™×¢×•×ª : 0.00 - - â‚ª ×©×¢×•×ª × ×•×¡×¤×•×ª 12 ×©×¢×•×ª : ( 600.00 - ×¡×”\"×› ×‘×¨×•×˜×• : 6600.00 : ×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª â‚ª 390.00 : ( 6.5 % ) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” - 186.00 â‚ª : ( 3.1 % ) ×‘×™×˜×•×— ×‘×¨×™××•×ª - â‚ª 420.00 : ( 7 % ) ×‘×™×˜×•×— ×œ××•×ž×™ - ×¡×”\"×› × ×™×›×•×™×™× : 996.00 â‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** : 5604.00 **\n\nPayslip 10:\n×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 03/2025\n×¤×¨×˜×™ ×”×ž×¢×¡×™×§ :×¢×¡×§×™× ×‘×¢''×ž\n×¤×¨×˜×™ ×”×¢×•×‘×“ ×™×©×¨××œ ×™×©×¨××œ×™ ×ª.×– :123456789,×›×ª×•×‘×ª :×©×œ×•× ×œ×›×\n:×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™×\n×©×›×¨ ×™×¡×•×“ :6000.00 -\n-\n×“×ž×™ × ×¡×™×¢×•×ª :250.00 -\n×©×¢×•×ª × ×•×¡×¤×•×ª )12 ×©×¢×•×ª (600.00 -\nâ‚ª ×¡×”\"×› ×‘×¨×•×˜×• :6850.00\n-\n:×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª\nâ‚ª 390.00 :(6.5%) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” -\n186.00â‚ª :(3.1%) ×‘×™×˜×•×— ×‘×¨×™××•×ª -\n420.00â‚ª :(7%) ×‘×™×˜×•×— ×œ××•×ž×™\nâ‚ª ×¡×”\"×› × ×™×›×•×™×™× :996.00\nâ‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** :5854.00** ×ª×œ×•×© ×©×›×¨ ×œ×—×•×“×© 03/2025 ×¤×¨×˜×™ ×”×ž×¢×¡×™×§ : ×¢×¡×§×™× ×‘×¢''×ž ×¤×¨×˜×™ ×”×¢×•×‘×“ ×™×©×¨××œ ×™×©×¨××œ×™ ×ª.×– : 123456789 , ×›×ª×•×‘×ª : ×©×œ×•× ×œ×›× : ×¤×™×¨×•×˜ ×ª×©×œ×•×ž×™× ×©×›×¨ ×™×¡×•×“ : 6000.00 - - ×“×ž×™ × ×¡×™×¢×•×ª : 250.00 - ×©×¢×•×ª × ×•×¡×¤×•×ª ) 12 ×©×¢×•×ª ( 600.00 - â‚ª ×¡×”\"×› ×‘×¨×•×˜×• : 6850.00 - : ×¤×™×¨×•×˜ × ×™×›×•×™×™× ×•×”×¤×¨×©×•×ª â‚ª 390.00 : ( 6.5 % ) ×”×¤×¨×©×” ×œ×¤× ×¡×™×” - 186.00 â‚ª : ( 3.1 % ) ×‘×™×˜×•×— ×‘×¨×™××•×ª - 420.00 â‚ª : ( 7 % ) ×‘×™×˜×•×— ×œ××•×ž×™ â‚ª ×¡×”\"×› × ×™×›×•×™×™× : 996.00 â‚ª ×¡×”\"×› ×œ×ª×©×œ×•× × ×˜×• ** : 5854.00 **"
        # contract_text=":×©×¢×•×ª × ×•×¡×¤×•×ª .5\n×‘×ž×™×“×” ×•×”×¢×•×‘×“ ×™×™×“×¨×© ×œ×¢×‘×•×“ ×©×¢×•×ª × ×•×¡×¤×•×ª, ×™×©×•×œ× ×©×›×¨ × ×•×¡×£ ×›×“×™×Ÿ\n,×¢×‘×•×¨ ×”×©×¢×ª×™×™× ×”×¨××©×•× ×•×ª ×”× ×•×¡×¤×•×ª ×‘×›×œ ×™×•× ×¢×‘×•×“×” 125% -\n,×¢×‘×•×¨ ×›×œ ×©×¢×” × ×•×¡×¤×ª ×ž×¢×‘×¨ ×œ×›×š 150% -\n×‘×•× ×•×¡×™× .6\n×”×ž×¢×¡×™×§ ×¨×©××™ ×œ×”×¢× ×™×§ ×œ×¢×•×‘×“ ×‘×•× ×•×¡ ×©× ×ª×™ ×‘×”×ª×× ×œ×©×™×§×•×œ ×“×¢×ª×• ×•×œ×‘×™×¦×•×¢×™ ×”×¢×•×‘×“ .×¡×›×•× ×”×‘×•× ×•×¡\n×™×™×§×‘×¢ ×‘×”×ª×× ×œ×©×™×§×•×œ ×“×¢×ª ×”×ž×¢×¡×™×§\n:×—×•×¤×©×” ×•×ž×—×œ×” .7\n,×™×ž×™ ×”×—×•×¤×©×” ×•×”×ž×—×œ×” ×™×”×™×• ×‘×”×ª×× ×œ×—×•×§×™ ×”×¢×‘×•×“×” ×”×§×™×™×ž×™× ×‘×ž×“×™× ×ª ×™×©×¨××œ\n:×¡×™×•× ×”×¢×¡×§×” .8\n.×›×œ ×¦×“ ×™×•×›×œ ×œ×¡×™×™× ××ª ×”×”×ª×§×©×¨×•×ª ×‘×”×•×“×¢×” ×ž×•×§×“×ž×ª ×©×œ 30 ×™×•× ×ž×¨××© ×‘×›×ª×‘\n×”×¦×“×“×™× ×ž×¡×›×™×ž×™× ×•×ž×ª×—×™×™×‘×™× ×‘×–××ª ×œ×¤×¢×•×œ ×‘×ª×•× ×œ×‘ ×•×‘××•×¤×Ÿ ×”×•×’×Ÿ\n;×•×œ×¨××™×” ×‘××• ×”×¦×“×“×™× ×¢×œ ×”×—×ª×•×\n×—×ª×™×ž×ª ×”×ž×¢×¡×™×§\n×—×ª×™×ž×ª ×”×¢×•×‘×“\n5.10.24\n5.10.24\n:×ª××¨×™×š\n:×ª××¨×™×š : ×©×¢×•×ª × ×•×¡×¤×•×ª .5 ×‘×ž×™×“×” ×•×”×¢×•×‘×“ ×™×™×“×¨×© ×œ×¢×‘×•×“ ×©×¢×•×ª × ×•×¡×¤×•×ª , ×™×©×•×œ× ×©×›×¨ × ×•×¡×£ ×›×“×™×Ÿ , ×¢×‘×•×¨ ×”×©×¢×ª×™×™× ×”×¨××©×•× ×•×ª ×”× ×•×¡×¤×•×ª ×‘×›×œ ×™×•× ×¢×‘×•×“×” 125 % - , ×¢×‘×•×¨ ×›×œ ×©×¢×” × ×•×¡×¤×ª ×ž×¢×‘×¨ ×œ×›×š 150 % - ×‘×•× ×•×¡×™× .6 ×”×ž×¢×¡×™×§ ×¨×©××™ ×œ×”×¢× ×™×§ ×œ×¢×•×‘×“ ×‘×•× ×•×¡ ×©× ×ª×™ ×‘×”×ª×× ×œ×©×™×§×•×œ ×“×¢×ª×• ×•×œ×‘×™×¦×•×¢×™ ×”×¢×•×‘×“ .×¡×›×•× ×”×‘×•× ×•×¡ ×™×™×§×‘×¢ ×‘×”×ª×× ×œ×©×™×§×•×œ ×“×¢×ª ×”×ž×¢×¡×™×§ : ×—×•×¤×©×” ×•×ž×—×œ×” .7 , ×™×ž×™ ×”×—×•×¤×©×” ×•×”×ž×—×œ×” ×™×”×™×• ×‘×”×ª×× ×œ×—×•×§×™ ×”×¢×‘×•×“×” ×”×§×™×™×ž×™× ×‘×ž×“×™× ×ª ×™×©×¨××œ : ×¡×™×•× ×”×¢×¡×§×” .8 .×›×œ ×¦×“ ×™×•×›×œ ×œ×¡×™×™× ××ª ×”×”×ª×§×©×¨×•×ª ×‘×”×•×“×¢×” ×ž×•×§×“×ž×ª ×©×œ 30 ×™×•× ×ž×¨××© ×‘×›×ª×‘ ×”×¦×“×“×™× ×ž×¡×›×™×ž×™× ×•×ž×ª×—×™×™×‘×™× ×‘×–××ª ×œ×¤×¢×•×œ ×‘×ª×•× ×œ×‘ ×•×‘××•×¤×Ÿ ×”×•×’×Ÿ ; ×•×œ×¨××™×” ×‘××• ×”×¦×“×“×™× ×¢×œ ×”×—×ª×•× ×—×ª×™×ž×ª ×”×ž×¢×¡×™×§ ×—×ª×™×ž×ª ×”×¢×•×‘×“ 5.10.24 5.10.24 : ×ª××¨×™×š : ×ª××¨×™×š"

        documents = {}
        if payslip_text:
            documents['payslip'] = payslip_text
        if contract_text:
            documents['contract'] = contract_text
        if attendance_text:
            documents['attendance report'] = attendance_text
            
        system_prompt = """You are an expert Israeli labour law attorney specializing in labor law compliance.
You have access to the internet and can search for relevant Israeli labor laws and legal judgments.
Respond in Hebrew. Think step-by-step and clearly explain your reasoning for any conclusions you draw.
When using online search, explicitly state what you searched for and how the results (or lack thereof) influenced your analysis.
Include links to all relevant laws, legal sources, and court judgments you reference.
Follow the required response format exactly and apply relevant laws and legal precedents as needed.
Do not include any disclaimers or advice to consult a lawyer; the user understands the nature of the information provided."""


        # Prepare the prompt for Gemini AI
        prompt = f"""
    
    DOCUMENTS PROVIDED FOR ANALYSIS:
    {', '.join(documents.keys())}

    ADDITIONAL CONTEXT:
    {context if context else 'No additional context provided.'}

    """

        # Add document contents to prompt
        for doc_type, content in documents.items():
            prompt += f"\n{doc_type.upper()} CONTENT:\n{content}\n"

        # General instructions are now outside the loop and conditional
        if type != 'warning_letter':
            prompt += f"""
    INSTRUCTIONS:
    1. If, after searching, you cannot find relevant labor laws online, respond with: "×œ× ×”×¦×œ×—×ª×™ ×œ×ž×¦×•× ×—×•×§×™ ×¢×‘×•×“×” ×¨×œ×•×•× ×˜×™×™× ×‘××™× ×˜×¨× ×˜ ×œ× ×™×ª×•×— ×”×ª××ž×”." in Hebrew.
    2. If, after searching, you cannot find relevant judgements online, respond with: "×œ× ×”×¦×œ×—×ª×™ ×œ×ž×¦×•× ×”×—×œ×˜×•×ª ×ž×©×¤×˜×™×•×ª ×¨×œ×•×•× ×˜×™×•×ª ×‘××™× ×˜×¨× ×˜ ×œ× ×™×ª×•×—." in Hebrew."""

        if(type=='report'):
            prompt += f"""
    3. For each payslip provided, analyze and identify any violations. For each violation found, respond in the exact format below, using clear line breaks and spacing:

    Violation Format:

    [VIOLATION TITLE]
    [DESCRIPTION OF SPECIFIC VIOLATION]
    [LAW REFERENCE AND YEAR (based on online search)]
    [About SIMILAR CASE OR LEGAL PRECEDENT (based on online search,seach thoroughly because there is a case for every laws out there`). If none is found, write: "×œ× × ×ž×¦××• ×ª×§×“×™×ž×™× ×¨×œ×•×•× ×˜×™×™× ×‘×—×™×¤×•×© ×”×ž×§×•×•×Ÿ."]
    [LEGAL IMPLICATIONS]
    [RECOMMENDED ACTIONS]
    
     ---

    Example of correctly formatted violation:

    Payslip 1:

    Possible Violation of Mandatory Pension Expansion Order

    The payslip shows no pension contribution, despite over 6 months of employment.

    According to the Mandatory Pension Expansion Order (2008) (found through online search).

    In the [NAME OF RULING FOUND ONLINE] ruling, there was a similar case and the employee won 10,000 thousand shekels there (based on online search results).

    Lack of contribution may entitle the employee to retroactive compensation or legal action.

    It is recommended to review the pension fund details, start date of employment, and contract terms.

    ---
    """
        
        elif type == "profitability":
            prompt += f"""
    INSTRUCTIONS:
    2. For each violation, search for similar legal cases in Israeli judgements found online and summarize both successful and unsuccessful outcomes.
    3. For unsuccessful precedents:
       - Explain why the claims were rejected, based only on the judgement information found online.
       - Clearly recommend against pursuing legal action, if applicable.
       - List the risks and potential costs involved.

    4. For successful precedents:
       - Calculate the average compensation awarded (based on judgements found online).
       - Estimate legal fees (30% of potential compensation).
       - Estimate tax deductions (25% of net compensation).
       - Include a time and effort cost estimate if available.

    Use the following format for your analysis:

    × ×™×ª×•×— ×›×“××™×•×ª ×›×œ×›×œ×™×ª:

    ×”×¤×¨×•×ª ×©×–×•×”×• (×¢×œ ×‘×¡×™×¡ ×”×—×•×§×™× ×©× ×ž×¦××• ××•× ×œ×™×™×Ÿ):
    [List identified violations]

    ×ª×§×“×™×ž×™× ×ž×©×¤×˜×™×™× (×ž×ª×•×š ×¤×¡×§×™ ×”×“×™×Ÿ ×©× ×ž×¦××• ××•× ×œ×™×™×Ÿ):
    [Summarize similar cases and their outcomes]

    ×‘×ž×§×¨×” ×©×œ ×ª×§×“×™×ž×™× ×©×œ×™×œ×™×™×:
    - ×¡×™×‘×•×ª ×œ×“×—×™×™×ª ×”×ª×‘×™×¢×•×ª: [Reasoning based on online judgements]
    - ×¡×™×›×•× ×™× ××¤×©×¨×™×™×: [List risks]
    - ×”×ž×œ×¦×”: ×œ× ×ž×•×ž×œ×¥ ×œ×”×’×™×© ×ª×‘×™×¢×” ×‘×©×œ [Explanation based on judgement analysis]

    ×‘×ž×§×¨×” ×©×œ ×ª×§×“×™×ž×™× ×—×™×•×‘×™×™×:
    × ×™×ª×•×— ×›×¡×¤×™:
    - ×¡×›×•× ×¤×™×¦×•×™ ×ž×ž×•×¦×¢ (×ž×¤×¡×™×§×•×ª ×“×™×Ÿ ×©× ×ž×¦××• ××•× ×œ×™×™×Ÿ): [AMOUNT] â‚ª
    - ×¢×œ×•×ª ×ž×©×•×¢×¨×ª ×©×œ ×¢×•×¨×š ×“×™×Ÿ (30%): [AMOUNT] â‚ª
    - ×”×©×œ×›×•×ª ×ž×¡ (25% ×ž×”×¡×›×•× × ×˜×•): [AMOUNT] â‚ª
    - ×¡×›×•× × ×˜×• ×ž×©×•×¢×¨: [AMOUNT] â‚ª

    ×”×ž×œ×¦×” ×¡×•×¤×™×ª:
    [Final recommendation based on analysis of judgements found online]
    
    â€“ ×¡×™×›×•×:  
×œ××—×¨ ×‘×—×™× ×”, ×”×¢×œ×•×ª ×”×ž×¨×‘×™×ª ×©× ×™×ª×Ÿ ×œ×ª×‘×•×¢ ×”×™× [MAX_CLAIM] â‚ª, ×”×•×¦××•×ª ×ž×¡ ×ž×•×¢×¨×›×•×ª ×‘-[TAX_COST] â‚ª. ×‘×ž×§×¨×” ×©×œ ×–×›×™×™×”, ×”×¡×›×•× × ×˜×• ×”×ž×©×•×¢×¨ ×”×•× [NET_AFTER_TAX] â‚ª.

    """
        
        elif(type=='professional'):
            prompt += f"""
    Analyze the provided documents for labor law violations based strictly on the Israeli labor laws you find online and the content of the documents. For each violation, calculate the monetary differences using only those laws.
    Provide your analysis in the following format, entirely in Hebrew:

× ×™×ª×•×— ×ž×§×¦×•×¢×™ ×©×œ ×”×¤×¨×•×ª ×©×›×¨:

×”×¤×¨×”: [×›×•×ª×¨×ª ×”×”×¤×¨×”]
[×ª×™××•×¨ ×ž×¤×•×¨×˜ ×©×œ ×”×”×¤×¨×”, ×›×•×œ×œ ×ª××¨×™×›×™× ×¨×œ×•×•× ×˜×™×™×, ×©×¢×•×ª ×¢×‘×•×“×”, ×©×›×¨ ×©×¢×ª×™ ×•×—×™×©×•×‘×™×, ×‘×”×ª×‘×¡×¡ ××š ×•×¨×§ ×¢×œ ×”×—×•×§×™× ×”×™×©×¨××œ×™×™× ×©× ×ž×¦××• ××•× ×œ×™×™×Ÿ ×•×”×ž×¡×ž×›×™× ×©×¡×•×¤×§×•.
×“×•×’×ž×”: ×”×¢×•×‘×“ ×¢×‘×“ X ×©×¢×•×ª × ×•×¡×¤×•×ª ×‘×™×Ÿ [×—×•×“×© ×©× ×”] ×œ-[×—×•×“×© ×©× ×”]. ×œ×¤×™ ×©×›×¨ ×©×¢×ª×™ ×‘×¡×™×¡×™ ×©×œ [×©×›×¨] â‚ª ×•×©×™×¢×•×¨×™ ×ª×©×œ×•× ×©×¢×•×ª × ×•×¡×¤×•×ª ([×©×™×¢×•×¨1]% ×¢×‘×•×¨ X ×”×©×¢×•×ª ×”×¨××©×•× ×•×ª, [×©×™×¢×•×¨2]% ×œ××—×¨ ×ž×›×Ÿ) ×›×¤×™ ×©×ž×•×¤×™×¢ ×‘×—×•×§×™ ×”×¢×‘×•×“×” ×©× ×ž×¦××• ××•× ×œ×™×™×Ÿ, ×”×¢×•×‘×“ ×”×™×” ×–×›××™ ×œ-[×¡×›×•×] â‚ª ×œ×—×•×“×©. ×‘×¤×•×¢×œ ×§×™×‘×œ ×¨×§ [×¡×›×•× ×©×§×™×‘×œ] â‚ª ×œ×ž×©×š X ×—×•×“×©×™× ×•-[×¡×›×•×] â‚ª ×‘×—×•×“×© [×—×•×“×©].]
×¡×”"×› ×—×•×‘: [×¡×›×•× ×”×”×¤×¨×© ×¢×‘×•×¨ ×”×¤×¨×” ×–×•] â‚ª

×”×¤×¨×”: [×›×•×ª×¨×ª ×”×”×¤×¨×”]
[×ª×™××•×¨ ×ž×¤×•×¨×˜ ×©×œ ×”×”×¤×¨×”, ×›×•×œ×œ ×ª××¨×™×›×™× ×•×—×™×©×•×‘×™×, ×‘×”×ª×‘×¡×¡ ××š ×•×¨×§ ×¢×œ ×”×—×•×§×™× ×©× ×ž×¦××• ××•× ×œ×™×™×Ÿ ×•×”×ž×¡×ž×›×™×. 
×“×•×’×ž×”: ×‘×—×•×“×© [×—×•×“×© ×©× ×”] ×œ× ×‘×•×¦×¢×” ×”×¤×§×“×” ×œ×¤× ×¡×™×”. ×”×ž×¢×¡×™×§ ×ž×—×•×™×‘ ×œ×”×¤×§×™×“ [××—×•×–]% ×ž×”×©×›×¨ ×‘×’×•×‘×” [×©×›×¨] â‚ª = [×¡×›×•×] â‚ª ×‘×”×ª×× ×œ×—×•×§/×¦×• ×”×¨×—×‘×” ×©× ×ž×¦× ××•× ×œ×™×™×Ÿ.]
×¡×”"×› ×—×•×‘ ×¤× ×¡×™×”: [×¡×›×•× ×—×•×‘ ×”×¤× ×¡×™×” ×œ×”×¤×¨×” ×–×•] â‚ª

---

×¡×”"×› ×ª×‘×™×¢×” ×ž×©×¤×˜×™×ª (×œ× ×›×•×œ×œ ×¨×™×‘×™×ª): [×”×¡×›×•× ×”×›×•×œ×œ ×œ×ª×‘×™×¢×” ×ž×›×œ×œ ×”×”×¤×¨×•×ª] â‚ª  
××¡×ž×›×ª××•×ª ×ž×©×¤×˜×™×•×ª: [×¨×©×™×ž×ª ×©×ž×•×ª ×”×—×•×§ ×”×¨×œ×•×•× ×˜×™×™× ×ž×ª×•×š ×”×—×•×§×™× ×”×™×©×¨××œ×™×™× ×©× ×ž×¦××• ××•× ×œ×™×™×Ÿ. ×œ×“×•×’×ž×”: ×—×•×§ ×©×¢×•×ª ×¢×‘×•×“×” ×•×ž× ×•×—×”, ×¦×• ×”×¨×—×‘×” ×œ×¤× ×¡×™×” ×—×•×‘×”]

"""


        elif(type=='warning_letter'):
            format_content = self.letter_format.get_format().get('content', '')
            prompt += f"""
    INSTRUCTIONS:
    1. Analyze the provided documents for labor law violations *based exclusively on the Israeli LABOR LAWS and JUDGEMENTS you find online*.
    2. If violations are found, generate a formal warning letter using the provided template.
    3. If no violations are found, respond with: "×œ× × ×ž×¦××• ×”×¤×¨×•×ª ×”×ž×¦×“×™×§×•×ª ×ž×›×ª×‘ ×”×ª×¨××”." in Hebrew.
    4. directly return the letter only and do not include any other text or explanations.

    Warning Letter Template:
    {format_content}

    Please generate the warning letter in Hebrew with the following guidelines:
    - Replace [EMPLOYER_NAME] with the employer's name from the documents
    - Replace [VIOLATION_DETAILS] with specific details of each violation found (based on laws found online)
    - Replace [LAW_REFERENCES] with relevant labor law citations *from the Israeli labor laws found online*.
    - Replace [REQUIRED_ACTIONS] with clear corrective actions needed
    - Replace [DEADLINE] with a reasonable timeframe for corrections (typically 14 days)
    - Maintain a professional and formal tone throughout
    - Include all violations found in the analysis (based on laws found online)
    - Format the letter according to the provided template structure
    """

        elif(type=='easy'):
            prompt += f"""
ðŸ”’ ×ž×˜×¨×”: ×¦×•×¨ ×¡×™×›×•× ×§×¦×¨ ×•×‘×¨×•×¨ ×©×œ ×”×”×¤×¨×•×ª ×‘×ª×œ×•×©×™ ×”×©×›×¨ ×©×œ ×”×¢×•×‘×“.
ðŸ“Œ ×›×œ×œ×™× ×ž×—×™×™×‘×™×:
	1. ×›×ª×•×‘ ×‘×¢×‘×¨×™×ª ×‘×œ×‘×“ â€“ ××œ ×ª×©×ª×ž×© ×‘×× ×’×œ×™×ª ×‘×›×œ×œ.
	2. ×¢×‘×•×¨ ×›×œ ×—×•×“×© ×”×¦×’ ××ª ×”×”×¤×¨×•×ª ×‘×©×•×¨×•×ª × ×¤×¨×“×•×ª, ×›×œ ×©×•×¨×” ×‘×¤×•×¨×ž×˜ ×”×‘×:
âŒ [×¡×•×’ ×”×”×¤×¨×” ×‘×§×¦×¨×”] â€“ [×¡×›×•× ×‘×©"×— ×¢× â‚ª, ×›×•×œ×œ ×¤×¡×™×§ ×œ××œ×¤×™×]
×œ×“×•×’×ž×”: âŒ ×œ× ×©×•×œ× ×”×—×–×¨ × ×¡×™×¢×•×ª ×‘×¤×‘×¨×•××¨ 2025 â€“ 250 â‚ª
	3. ×× ×™×© ×ž×¡×¤×¨ ×¨×›×™×‘×™ ×¤× ×¡×™×” (×¢×•×‘×“/×ž×¢×¡×™×§/×‘×¨×™××•×ª) ×‘×—×•×“×© ×ž×¡×•×™× â€“ ×—×‘×¨ ××•×ª× ×œ×¡×›×•× ××—×“ ×©×œ ×¤× ×¡×™×” ×‘××•×ª×• ×”×—×•×“×©.
	4. ×›×œ ×”×¡×›×•×ž×™× ×™×•×¦×’×• ×¢× ×¤×¡×™×§×™× ×œ××œ×¤×™× ×•×¢× â‚ª ×‘×¡×•×£.
	5. ×—×™×©×•×‘ ×”×¡×›×•× ×”×›×•×œ×œ ×™×•×¤×™×¢ ×‘×©×•×¨×” × ×¤×¨×“×ª:
ðŸ’° ×¡×”"×›: [×¡×›×•× ×›×•×œ×œ] â‚ª
	6. ×”×•×¡×£ ×”×ž×œ×¦×” ×‘×¡×•×£:
ðŸ“ ×ž×” ×œ×¢×©×•×ª ×¢×›×©×™×•:
×¤× ×”/×™ ×œ×ž×¢×¡×™×§ ×¢× ×“×¨×™×©×” ×œ×ª×©×œ×•× ×”×¡×›×•×ž×™×.
×× ××™×Ÿ ×ž×¢× ×” â€“ ×ž×•×ž×œ×¥ ×œ×¤× ×•×ª ×œ×™×™×¢×•×¥ ×ž×©×¤×˜×™.
ðŸ“ ×”× ×—×™×•×ª × ×•×¡×¤×•×ª:
	â€¢ ××™×Ÿ ×œ×›×ª×•×‘ ×ž×¡×¤×¨×™× ×‘×œ×™ ×”×§×©×¨, ×›×œ ×©×•×¨×” ×—×™×™×‘×ª ×œ×”×™×•×ª ×ž×œ×•×•×” ×‘×—×•×“×©.
	â€¢ ×ž×™×–×•×’ ×©×•×¨×•×ª: ×× ×‘××•×ª×• ×—×•×“×© ×™×© ×›×ž×” ×¨×›×™×‘×™× ×©×œ ×¤× ×¡×™×” â€“ ×ž×™×–×’ ××•×ª× ×œ×©×•×¨×” ××—×ª.
	â€¢ ×”×¡×¨ ×©×•×¨×•×ª ×œ×œ× ×¡×›×•× ×‘×¨×•×¨.
	â€¢ × ×™×¡×•×— ×¤×©×•×˜, ×œ×œ× ×ž×™× ×•×—×™× ×ž×©×¤×˜×™×™×, ×”×‘×”×¨×•×ª ××• ×”×¡×‘×¨×™× ×˜×›× ×™×™×.
	â€¢ ××™×Ÿ ×œ×¦×™×™×Ÿ "×¨×›×™×‘ ×¢×•×‘×“", "×¨×›×™×‘ ×ž×¢×¡×™×§", "×œ× ×”×•×¤×§×“" â€“ ×‘×ž×§×•× ×–××ª ×›×ª×•×‘: "×œ× ×©×•×œ×ž×” ×¤× ×¡×™×”".
ðŸŽ¯ ×¤×œ×˜ ×¨×¦×•×™:
	â€¢ ×©×•×¨×•×ª ×ž×¡×•×“×¨×•×ª ×œ×¤×™ ×—×•×“×©×™×
	â€¢ ××™×Ÿ ×›×¤×™×œ×•×™×•×ª
	â€¢ ×¡×›×•×ž×™× ×ž×“×•×™×§×™× ×‘×œ×‘×“
	â€¢ × ×™×¡×•×— ×‘×¨×•×¨ ×•×ž×•×‘×Ÿ
	â€¢ ×¢×‘×¨×™×ª ×‘×œ×‘×“

ðŸ§ª Example of desired output:
ðŸ“¢ ×¡×™×›×•× ×”×”×¤×¨×•×ª:
âŒ ×œ× ×©×•×œ× ×¢×‘×•×¨ ×©×¢×•×ª × ×•×¡×¤×•×ª ×‘× ×•×‘×ž×‘×¨ 2024 â€“ 495 â‚ª
âŒ ×œ× ×©×•×œ×ž×” ×¤× ×¡×™×” ×‘× ×•×‘×ž×‘×¨ 2024 â€“ 750 â‚ª
âŒ ×œ× ×©×•×œ×ž×” ×¤× ×¡×™×” ×‘×“×¦×ž×‘×¨ 2024 â€“ 1,221 â‚ª
âŒ ×œ× ×©×•×œ×ž×” ×¤× ×¡×™×” ×‘×™× ×•××¨ 2025 â€“ 831 â‚ª
âŒ ×œ× ×©×•×œ× ×”×—×–×¨ × ×¡×™×¢×•×ª ×‘×¤×‘×¨×•××¨ 2025 â€“ 250 â‚ª
âŒ ×œ× ×©×•×œ×ž×” ×¤× ×¡×™×” ×‘×¤×‘×¨×•××¨ 2025 â€“ 858 â‚ª
âŒ ×œ× ×©×•×œ×ž×” ×¤× ×¡×™×” ×‘×ž×¨×¥ 2025 â€“ 866 â‚ª
ðŸ’° ×¡×”"×›: 5,271 â‚ª
ðŸ“ ×ž×” ×œ×¢×©×•×ª ×¢×›×©×™×•:
×¤× ×”/×™ ×œ×ž×¢×¡×™×§ ×¢× ×“×¨×™×©×” ×œ×ª×©×œ×•× ×”×¡×›×•×ž×™×.
×× ××™×Ÿ ×ž×¢× ×” â€“ ×ž×•×ž×œ×¥ ×œ×¤× ×•×ª ×œ×™×™×¢×•×¥ ×ž×©×¤×˜×™.
"""

        elif(type=='table'):
            prompt = f"""
××ª×” ×¢×•×–×¨ ×ž×©×¤×˜×™ ×ž×™×•×ž×Ÿ. ×¢×œ×™×š ×œ× ×ª×— ××ª ×¨×©×™×ž×ª ×”×”×¤×¨×•×ª ×•×œ×”×¤×™×§ ×¨×©×™×ž×ª ×ª×‘×™×¢×•×ª ×ž×¡×•×“×¨×ª ×œ×¤×™ ×ž×¡×ž×š (×œ×“×•×’×ž×”: ×ª×œ×•×© ×©×›×¨ ×ž×¡' 1, ×ž×¡×ž×š ×©×™×ž×•×¢, ×ž×›×ª×‘ ×¤×™×˜×•×¨×™×Ÿ ×•×›×•').

×”× ×—×™×•×ª:

1. ×¡×“×¨ ××ª ×”×ª×‘×™×¢×•×ª ×œ×¤×™ ×ž×¡×ž×š: ×›×œ ×§×‘×•×¦×” ×ž×ª×—×™×œ×” ×‘×›×•×ª×¨×ª ×›×ž×• "×ª×œ×•×© ×©×›×¨ ×ž×¡' 4 â€“ 05/2024:".

2. ×ª×—×ª ×›×œ ×›×•×ª×¨×ª, ×¦×•×¨ ×¨×©×™×ž×” ×ž×ž×•×¡×¤×¨×ª ×‘××•×ª×™×•×ª ×¢×‘×¨×™×•×ª (×., ×‘., ×’. ×•×›×•').

3. ×”×©×ª×ž×© ×‘×ž×‘× ×” ×”×§×‘×•×¢ ×”×‘×:
   ×. ×¡×›×•× ×©×œ [amount] ×©"×— ×¢×‘×•×¨ \[×ª×™××•×¨ ×§×¦×¨ ×©×œ ×”×”×¤×¨×”].

4. ×”×©×ª×ž×© ×‘×¤×•×¨×ž×˜ ×ž×¡×¤×¨×™× ×¢× ×¤×¡×™×§×™× ×œ××œ×¤×™× ×•×©×ª×™ ×¡×¤×¨×•×ª ××—×¨×™ ×”× ×§×•×“×” (×œ×ž×©×œ: 1,618.75 ×©"×—).

5. ×›×ª×•×‘ "×©"×—" ××—×¨×™ ×”×¡×›×•× â€” ×œ× â‚ª.

6. ××œ ×ª×¡×›× ××ª ×›×œ×œ ×”×”×¤×¨×•×ª â€“ ×”×¦×’ ×¨×§ ××ª ×”×¤×™×¨×•×˜ ×œ×¤×™ ×ž×¡×ž×š.

7. ××œ ×ª×•×¡×™×£ ×‘×•×œ×˜×™×, ×˜×‘×œ××•×ª ××• ×”×¢×¨×•×ª.

× ×ª×•× ×™ ×”×§×œ×˜ ×œ×“×•×’×ž×”:
âŒ ××™ ×ª×©×œ×•× ×©×¢×•×ª × ×•×¡×¤×•×ª (×ª×œ×•×© 6, 11/2024) â€“ 495 ×©"×—
âŒ ×”×¢×“×¨ ×¨×›×™×‘ ×ž×¢×‘×™×“ ×œ×¤× ×¡×™×” (×ª×œ×•×© 6, 11/2024) â€“ 750 ×©"×—
âŒ ×”×¢×“×¨ ×¨×›×™×‘ ×¢×•×‘×“ ×œ×¤× ×¡×™×” (×ª×œ×•×© 7, 12/2024) â€“ 396 ×©"×—
âŒ ×”×¢×“×¨ × ×¡×™×¢×•×ª (×ª×œ×•×© 9, 02/2025) â€“ 250 ×©"×—

×¤×œ×˜ × ×“×¨×© ×œ×“×•×’×ž×”:

×ª×œ×•×© ×©×›×¨ ×ž×¡' 6 â€“ 11/2024:
×. ×¡×›×•× ×©×œ 495.00 ×©"×— ×¢×‘×•×¨ ××™ ×ª×©×œ×•× ×©×¢×•×ª × ×•×¡×¤×•×ª.
×‘. ×¡×›×•× ×©×œ 750.00 ×©"×— ×¢×‘×•×¨ ×”×¢×“×¨ ×¨×›×™×‘ ×ž×¢×‘×™×“ ×œ×¤× ×¡×™×”.

×ª×œ×•×© ×©×›×¨ ×ž×¡' 7 â€“ 12/2024:
×. ×¡×›×•× ×©×œ 396.00 ×©"×— ×¢×‘×•×¨ ×”×¢×“×¨ ×¨×›×™×‘ ×¢×•×‘×“ ×œ×¤× ×¡×™×”.

×ª×œ×•×© ×©×›×¨ ×ž×¡' 9 â€“ 02/2025:
×. ×¡×›×•× ×©×œ 250.00 ×©"×— ×¢×‘×•×¨ ×”×¢×“×¨ ×ª×©×œ×•× ×¢×‘×•×¨ × ×¡×™×¢×•×ª.

×”×—×–×¨ ××ª ×”×¤×œ×˜ ×‘×¤×•×¨×ž×˜ ×–×” ×‘×œ×‘×“, ×ž×•×¤×¨×“ ×œ×¤×™ ×›×œ ×ž×¡×ž×š.

"""
        
        elif(type == 'claim'):
            prompt = f"""
×ž×©×™×ž×”:
×›×ª×•×‘ ×˜×™×•×˜×ª ×›×ª×‘ ×ª×‘×™×¢×” ×œ×‘×™×ª ×”×“×™×Ÿ ×”××–×•×¨×™ ×œ×¢×‘×•×“×”, ×‘×”×ª×× ×œ×ž×‘× ×” ×”×ž×©×¤×˜×™ ×”× ×”×•×’ ×‘×™×©×¨××œ.

× ×ª×•× ×™×:
×”×©×ª×ž×© ×‘×ž×™×“×¢ ×ž×ª×•×š ×”×ž×¡×ž×›×™× ×©×¦×•×¨×¤×• (×›×’×•×Ÿ ×ª×œ×•×©×™ ×©×›×¨, ×”×¡×›×ž×™ ×¢×‘×•×“×”, ×”×•×“×¢×•×ª ×¤×™×˜×•×¨×™×, ×©×™×—×•×ª ×¢× ×”×ž×¢×¡×™×§) ×•×‘×ž×ž×¦××™× ×©× ×ž×¦××• ×‘× ×™×ª×•×— ×§×•×“× ×©×œ ×”×”×¤×¨×•×ª.

×¤×•×¨×ž×˜ ×œ×›×ª×™×‘×”:
1. ×›×•×ª×¨×ª: "×‘×™×ª ×”×“×™×Ÿ ×”××–×•×¨×™ ×œ×¢×‘×•×“×” ×‘[×©× ×¢×™×¨]"
2. ×¤×¨×˜×™ ×”×ª×•×‘×¢/×ª:
   - ×©× ×ž×œ×, ×ª"×–, ×›×ª×•×‘×ª, ×˜×œ×¤×•×Ÿ, ×ž×™×™×œ
3. ×¤×¨×˜×™ ×”× ×ª×‘×¢/×ª (×ž×¢×¡×™×§):
   - ×©× ×”×—×‘×¨×”/×ž×¢×¡×™×§, ×—.×¤./×ª"×–, ×›×ª×•×‘×ª, ×˜×œ×¤×•×Ÿ, ×ž×™×™×œ (×× ×§×™×™×)
4. ×›×•×ª×¨×ª: "×›×ª×‘ ×ª×‘×™×¢×”"
5. ×¤×ª×™×— ×ž×©×¤×˜×™:
   ×‘×™×ª ×”×“×™×Ÿ ×”× ×›×‘×“ ×ž×ª×‘×§×© ×œ×–×ž×Ÿ ××ª ×”× ×ª×‘×¢/×ª ×œ×“×™×Ÿ ×•×œ×—×™×™×‘×•/×” ×œ×©×œ× ×œ×ª×•×‘×¢/×ª ××ª ×”×¡×›×•×ž×™× ×”×ž×¤×•×¨×˜×™×, ×ž×”× ×™×ž×•×§×™× ×”×‘××™×:
6. ×¡×¢×™×£ 1 â€“ ×¨×§×¢ ×¢×•×‘×“×ª×™:
   ×ª×™××•×¨ ×ª×§×•×¤×ª ×”×¢×‘×•×“×”, ×ª×¤×§×™×“×™×, ×ª××¨×™×š ×ª×—×™×œ×” ×•×¡×™×•× (×× ×¨×œ×•×•× ×˜×™), ×ž×”×•×ª ×™×—×¡×™ ×”×¢×‘×•×“×”, ×ž×§×•× ×”×¢×‘×•×“×”.
7. ×¡×¢×™×£ 2 â€“ ×¢×™×œ×•×ª ×”×ª×‘×™×¢×” (×œ×¤×™ ×”×¤×¨×•×ª):
   ×œ×›×œ ×”×¤×¨×”:
     - ××™×–×” ×—×•×§ ×”×•×¤Öµ×¨ (×œ×“×•×’': ×—×•×§ ×©×›×¨ ×ž×™× ×™×ž×•×, ×—×•×§ ×©×¢×•×ª ×¢×‘×•×“×” ×•×ž× ×•×—×” ×•×›×•')
     - ×¤×™×¨×•×˜ ×”×¢×•×‘×“×•×ª ×•×”×ª×§×•×¤×” ×”×¨×œ×•×•× ×˜×™×ª
     - ×¡×›×•× ×”×¤×™×¦×•×™ ××• ×”× ×–×§
     - ××¡×ž×›×ª××•×ª ×ž×©×¤×˜×™×•×ª ×× ×¨×œ×•×•× ×˜×™
8. ×¡×¢×™×£ 3 â€“ × ×–×§×™× ×©× ×’×¨×ž×•:
   ×¡×›×•×ž×™× ×›×¡×¤×™×™× (×‘×¤×™×¨×•×˜), × ×–×§ ×œ× ×ž×ž×•× ×™ ×× ×§×™×™× (×¢×•×’×ž×ª × ×¤×©).
9. ×¡×¢×™×£ 4 â€“ ×¡×¢×“×™× ×ž×‘×•×§×©×™×:
   ×ª×©×œ×•× ×”×¤×¨×©×™×, ×¤×™×¦×•×™×™×, ×¨×™×‘×™×ª ×•×”×¦×ž×“×”, ×”×•×¦××•×ª ×ž×©×¤×˜, ×©×›×¨ ×˜×¨×—×ª ×¢×•"×“, ×•×›×œ ×¡×¢×“ ××—×¨.
10. ×¡×¢×™×£ 5 â€“ ×¡×ž×›×•×ª ×©×™×¤×•×˜:
   ×¦×™×™×Ÿ ×¡×ž×›×•×ª ×‘×™×ª ×”×“×™×Ÿ ×œ×¢×‘×•×“×” ×œ×¤×™ ×—×•×§ ×‘×™×ª ×”×“×™×Ÿ ×œ×¢×‘×•×“×” ×ª×©×›"×˜â€“1969.
11. ×¡×¢×™×£ 6 â€“ ×“×™×•×Ÿ ×ž×§×“×™×/×”×œ×™×š ×ž×”×™×¨ (×× ×¨×œ×•×•× ×˜×™).
12. ×¡×¢×™×£ 7 â€“ ×›×ª×•×‘×•×ª ×œ×”×ž×¦××ª ×›×ª×‘×™ ×‘×™-×“×™×Ÿ:
   ×›×ª×•×‘×ª ×”×ª×•×‘×¢ ×•×”× ×ª×‘×¢.
13. ×¡×™×•×:
   ×—×ª×™×ž×”, ×ª××¨×™×š, ×¨×©×™×ž×ª × ×¡×¤×—×™× ×ª×•×ž×›×™× (×ª×œ×•×©×™ ×©×›×¨, ×ž×›×ª×‘×™× ×•×›×•').

×©×¤×”:
- ×›×ª×•×‘ ×‘×¢×‘×¨×™×ª ×ž×©×¤×˜×™×ª, ×¨×©×ž×™×ª ×•×ž×¡×•×“×¨×ª.
- ×¡×“×¨ ××ª ×”×ª×‘×™×¢×” ×¢× ×›×•×ª×¨×•×ª, ×¡×¢×™×¤×™× ×ž×ž×•×¡×¤×¨×™× ×•×¨×•×•×—×™× ×‘×¨×•×¨×™×.
- ××œ ×ª×ž×¦×™× ×¢×•×‘×“×•×ª ××• ×—×•×§×™×. ×× ×—×¡×¨ ×ž×™×“×¢ â€“ ×”×©××¨ ×©×“×” ×¨×™×§ ×œ×¦×•×¨×š ×”×©×œ×ž×” ×¢"×™ ×”×ž×©×ª×ž×©.

××–×”×¨×”:
×‘×¡×™×•×, ×›×ª×•×‘ ×ž×©×¤×˜: "×”×˜×™×•×˜×” × ×›×ª×‘×” ××•×˜×•×ž×˜×™×ª ×œ×¦×•×¨×š ×¢×–×¨×” ×¨××©×•× ×™×ª ×‘×œ×‘×“. ×ž×•×ž×œ×¥ ×œ×¤× ×•×ª ×œ×¢×•×¨×š/×ª ×“×™×Ÿ ×ž×•×¡×ž×š/×ª ×œ×¤× ×™ ×”×’×©×” ×œ×‘×™×ª ×”×“×™×Ÿ."

"""

        # Conditionally add the IMPORTANT block, excluding it for 'warning_letter' and 'easy'
        # if type != 'warning_letter' and type != 'easy' and type != 'table':
            prompt += f"""
    IMPORTANT:
    - ×¢×‘×•×¨ ×›×œ ×”×¤×¨×”, ×”×¦×’ ×—×™×©×•×‘×™× ×‘×¨×•×¨×™× ×›×›×œ ×©× ×™×ª×Ÿ.
    - ×—×©×‘ ×¡×›×•× ×›×•×œ×œ ×¢×‘×•×¨ ×›×œ ×”×¤×¨×” ×‘× ×¤×¨×“.
    - ×—×©×‘ ××ª ×¡×š ×¡×›×•× ×”×ª×‘×™×¢×” ×¢×œ ×™×“×™ ×—×™×‘×•×¨ ×›×œ ×”×”×¤×¨×•×ª.
    - ×¦×™×™×Ÿ ×‘×¡×•×£ ××ª ×©×ž×•×ª ×”×—×•×§×™× ×”×¨×œ×•×•× ×˜×™×™× ×©×©×™×ž×©×• ×œ× ×™×ª×•×—.
    - Do not guess. Respond only with data that is verifiable through online sources.
    - Format each violation with proper spacing and line breaks as shown above
    - Analyze each payslip separately and clearly indicate which payslip the violations belong to
    - Separate multiple violations with '---'
    - If no violations are found against the relevant laws in a payslip, respond with: "×œ× × ×ž×¦××• ×”×¤×¨×•×ª ×‘×ª×œ×•×© ×ž×¡×¤×¨ [X]" in hebrew
    - If no violations are found in any payslip, respond with: "×œ× × ×ž×¦××• ×”×¤×¨×•×ª × ×’×“ ×—×•×§×™ ×”×¢×‘×•×“×” ×”×¨×œ×•×•× ×˜×™×™× ×©× ×ž×¦××•." in hebrew
    """

        try:
            gemini_api_key = os.environ.get("GOOGLE_CLOUD_VISION_API_KEY")
            if not gemini_api_key:
                raise ValueError("GEMINI_API_KEY not found in environment variables.")

            client = genai.Client(api_key=gemini_api_key)
            model_name = "gemini-2.5-pro-preview-05-06"
            
            api_contents = [
                types.Content(
                    role="user",
                    parts=[
                        types.Part.from_text(text=prompt),
                    ],
                ),
            ]
            
            tools_config = [
                types.Tool(google_search=types.GoogleSearch()),
            ]
            
            gen_config = types.GenerateContentConfig(
                temperature=0,
                tools=tools_config,
                response_mime_type="text/plain",
                system_instruction=[
                     types.Part.from_text(text=system_prompt),
                ],
            )

            response_stream = client.models.generate_content_stream(
                model=model_name,
                contents=api_contents,
                config=gen_config, 
            )
            
            analysis_parts = []
            for chunk in response_stream:
                if chunk.text: # Ensure text exists before appending
                    analysis_parts.append(chunk.text)
            analysis = "".join(analysis_parts)
            
            # Structure the result
            result = {
                "legal_analysis": analysis,
                "status": "success"
            }
            
            return result
            
        except Exception as e:
            # Log the full error for debugging if possible, or at least the type and message
            error_detail = f"Error generating legal analysis with new API: {str(e)}"
            # Check if the error is from genai and has more specific details
            if hasattr(e, 'error'): # For google.api_core.exceptions.GoogleAPIError
                error_detail = f"Error generating legal analysis with new API: {e.message}"

            raise HTTPException(
                status_code=500,
                detail=error_detail
            )

    def _compress_image(self, image_bytes: bytes, max_size_mb: int = 4) -> bytes:
        # Convert size to bytes
        max_size_bytes = max_size_mb * 1024 * 1024
        
        # If image is already smaller than max size, return original
        if len(image_bytes) <= max_size_bytes:
            return image_bytes
        
        # Open image using PIL
        img = Image.open(BytesIO(image_bytes))
        
        # Get original dimensions
        width, height = img.size
        
        # Scale down large images while maintaining aspect ratio
        max_dimension = 3000  # Maximum dimension for width or height
        if width > max_dimension or height > max_dimension:
            scale = min(max_dimension / width, max_dimension / height)
            new_width = int(width * scale)
            new_height = int(height * scale)
            img = img.resize((new_width, new_height), Image.Resampling.LANCZOS)
        
        # Preserve original format if possible
        output_format = img.format or 'JPEG'
        
        # Initial quality and compression settings
        quality = 95
        output = BytesIO()
        
        # Progressive quality reduction with format-specific handling
        while quality > 20:  # Increased minimum quality threshold
            output.seek(0)
            output.truncate(0)
            
            if output_format == 'JPEG':
                img.save(output, format=output_format, quality=quality, optimize=True)
            elif output_format == 'PNG':
                img.save(output, format=output_format, optimize=True)
            else:
                # Default to JPEG for unsupported formats
                img.save(output, format='JPEG', quality=70, optimize=True)
            
            if output.tell() <= max_size_bytes:
                break
            
            # More gradual quality reduction
            quality -= 5
        
        # If still too large, convert to JPEG as last resort
        if output.tell() > max_size_bytes and output_format != 'JPEG':
            output.seek(0)
            output.truncate(0)
            img.save(output, format='JPEG', quality=70, optimize=True)
        
        return output.getvalue()

    def _extract_text2(self, content: bytes, filename: str, compress: bool = False) -> str:
        if filename.lower().endswith('.pdf'):
            try:
                pdf_file = BytesIO(content)
                text = ''
                with pdfplumber.open(pdf_file) as pdf:
                    for page in pdf.pages:
                        page_text = page.extract_text()
                        if page_text and page_text.strip():
                            text += page_text + "\n"
                        else:
                            # Convert PDF page to image and use Vision API
                            img = page.to_image(resolution=300).original
                            img_byte_arr = io.BytesIO()
                            img.save(img_byte_arr, format='PNG')
                            img_content = img_byte_arr.getvalue()
                            
                            vision_image = vision.Image(content=img_content)
                            response = self.vision_client.text_detection(image=vision_image, image_context=self.image_context)
                            if response.text_annotations:
                                text_list = [text_annotation.description for text_annotation in response.text_annotations]
                                text += " ".join(text_list) + "\n"
            except Exception as e:
                raise HTTPException(
                    status_code=500,
                    detail=f"Error processing PDF: {str(e)}"
                )
        elif filename.lower().endswith('.docx'):
            doc_file = BytesIO(content)
            doc = Document(doc_file)
            text = '\n'.join([paragraph.text for paragraph in doc.paragraphs])
        elif filename.lower().endswith('.xlsx'):
            try:
                # Load Excel file into a pandas DataFrame
                excel_file = BytesIO(content)
                df = pd.read_excel(excel_file, sheet_name=None)  # Load all sheets
                
                # Extract text from all sheets
                text = ""
                for sheet_name, sheet_data in df.items():
                    text += f"Sheet: {sheet_name}\n"
                    text += sheet_data.to_string(index=False) + "\n\n"
            except Exception as e:
                raise HTTPException(
                    status_code=500,
                    detail=f"Error processing Excel file: {str(e)}"
                )
        else:
            # Compress image if needed
            if compress:
                content = self._compress_image(content)
            vision_image = vision.Image(content=content)
            response = self.vision_client.document_text_detection(image=vision_image, image_context=self.image_context)
            
            if response.error.message:
                raise HTTPException(
                    status_code=500,
                    detail=f"Vision API Error: {response.error.message}"
                )
            
            if response.text_annotations:
                text = " ".join([text_annotation.description for text_annotation in response.text_annotations])
            else:
                text = ""
        
        return text

    def summarise(self, ai_content_text: str) -> str:
        """
        Summarizes the given text using the Gemini 2.5 Flash model.
        """
        try:
            gemini_api_key = os.environ.get("GOOGLE_CLOUD_VISION_API_KEY")
            if not gemini_api_key:
                raise ValueError("GEMINI_API_KEY not found in environment variables.")

            client = genai.Client(api_key=gemini_api_key)
            # Using gemini-2.5-flash-preview-05-20 as requested for summarization
            model_name = "gemini-2.5-flash-preview-04-17"

            prompt = f"Please summarize the following text concisely:\n\n{ai_content_text}"
            
            api_contents = [
                types.Content(
                    role="user",
                    parts=[
                        types.Part.from_text(text=prompt),
                    ],
                ),
            ]
            
            # Minimal config for summarization, no tools needed unless specified
            gen_config = types.GenerateContentConfig(
                temperature=0.1, # Lower temperature for more factual summary
                response_mime_type="text/plain",
            )

            response = client.models.generate_content(
                model=model_name,
                contents=api_contents,
                config=gen_config,
            )
            
            summary = ""
            if response.text:
                summary = response.text
            
            return summary
            
        except Exception as e:
            error_detail = f"Error generating summary with Gemini Flash: {str(e)}"
            if hasattr(e, 'error'): # For google.api_core.exceptions.GoogleAPIError
                error_detail = f"Error generating summary with Gemini Flash: {e.message}"
            # Depending on how you want to handle errors, you might raise an HTTPException
            # or return an error message. For now, let's re-raise to be consistent.
            raise HTTPException(
                status_code=500,
                detail=error_detail
            )